#!/bin/bash

if [ ! -f "package.json" ]; then
    echo "Package.json not found. Do nothing."
    exit 0
else
    ppath=$(basename `cd ..; pwd`)
    cpath=$(basename `pwd`)
    if [ -h "node_modules" ]; then
        if [ ! -d $(readlink node_modules) ]; then
            echo "Link folder missing, fix it."
            mkdir -p ~/.node_modules/$ppath/$cpath
        else
            echo "Folder node_modules is already a link. Do nothing."
            exit 0
        fi
    elif [ -d "node_modules" ]; then
        mkdir -p ~/.node_modules/$ppath
        rm -rf ~/.node_modules/$ppath/$cpath
        mv node_modules ~/.node_modules/$ppath/$cpath
        ln -s ~/.node_modules/$ppath/$cpath node_modules
    else
        mkdir -p ~/.node_modules/$ppath/$cpath
        ln -s ~/.node_modules/$ppath/$cpath node_modules
    fi
fi
